#!/bin/bash

# # CA certificate (FQDN must be different from server/client)
# openssl genrsa -out ca.key 2048
# openssl req -new -x509 -days 365 -key ca.key -subj "/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=Acme Root CA" -out ca.crt
# 
# # server certificate (for multiple domains, change subjectAltName to: DNS:example.com,DNS:www.example.com)
# openssl req -newkey rsa:2048 -nodes -keyout server.key -subj "/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=localhost" -out server.csr
# openssl x509 -sha256 -req -extfile <(printf "subjectAltName=DNS:localhost") -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt
# 
# # 双向认证 client certificate (the p12/pem format may be useful for some clients)（可选）
# openssl req -newkey rsa:2048 -nodes -keyout client.key -subj "/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=client" -out client.csr
# openssl x509 -req -days 365 -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt
# openssl pkcs12 -export -clcerts -in client.crt -inkey client.key -out client.p12
# openssl pkcs12 -in client.p12 -out client.pem -clcerts

pass=$(openssl rand -hex 24)

echo ">>> $pass"
tmux new -A -s ttyd-daemon 'echo '$pass'; ttyd -t '\''theme={"background": "#eaeaea", "black": "#212121", "blue": "#134eb2", "brightBlack": "#424242", "brightBlue": "#53a4f3", "brightCyan": "#26bad1", "brightGreen": "#7aba39", "brightMagenta": "#a94dbb", "brightRed": "#e83a3f", "brightWhite": "#eeeeee", "brightYellow": "#fc8e08", "cursor": "#16aec9", "cyan": "#0e707c", "foreground": "#2d2d2c", "green": "#457b23", "magenta": "#550087", "red": "#b7141e", "white": "#d8d8d8", "yellow": "#fc7b08"}'\'' --ssl --ssl-cert ~/.ttyd/server.crt --ssl-key ~/.ttyd/server.key --ssl-ca ~/.ttyd/ca.crt -c ian:'$pass' tmux new -A -s ttyd'
