#!/bin/bash

if [ -z "${OPENAI_API_KEY:-}" ]; then
  export OPENAI_API_KEY="$(gopass show key/openai.com/personal)"
fi

system_message="You are a helpful assistant who writes short git commit messages."
user_message="Write the commit message for the following changes. Do not capitalize the first word and do not end in punctuation.

$(git diff --cached)"

message="$(openai api chat_completions.create -m gpt-3.5-turbo -g system "$system_message" -g user "$user_message")"
git commit -m "$message" -e
