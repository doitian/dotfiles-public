#!/usr/bin/env bash

# 1. Get the date of the last tag (to filter logs)
LAST_TAG="${1:-$(git describe --tags --abbrev=0)}"
LAST_TAG="${LAST_TAG:-4b825dc642cb6eb9a060e54bf8d69288fbee4904}"
SINCE="$(git log -n 1 --format='%cI' "$LAST_TAG")"

# 2. Generate the data dump
echo "--- START RAW DATA ---"
echo
echo "Since $LAST_TAG at $SINCE"

echo
echo "### GIT LOGS ###"
git log "$LAST_TAG"..HEAD --pretty=format:"%h - %an: %s"

echo; echo
echo "### MERGED PRS ###"
gh pr list -L 1000 --state merged --search "merged:>$SINCE" --json number,title,author,labels,body

echo; echo
echo "### CLOSED ISSUES ###"
gh issue list -L 1000 --state closed --search "closed:>$SINCE" --json number,title,labels

echo
echo "--- END RAW DATA ---"
