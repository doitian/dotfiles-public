#!/bin/bash

if [ -S .zeus.sock ]; then
  case "$1" in
    status)
      echo 'running'
      ;;
    rails)
      shift
      exec zeus "$@"
      ;;
    rake|start)
      exec zeus "$@"
      ;;
    testunit|rspec|cucumber)
      exec zeus test "$@"
      ;;
    *)
      exec "$@"
      ;;
  esac
elif [ -f config/spring.rb ]; then
  case "$1" in
    rails|rake|cucumber|rspec|testunit)
      exec spring "$@"
      ;;
    start)
      spring rake -T &> /dev/null
      spring status
      ;;
    *)
      exec "$@"
      ;;
  esac
else
  if ! [ "$1" = "start" ] && [ -f zeus.json ]; then
    echo "zeus.json is found but zeus is not started yet" >&2
  fi

  case "$1" in
    status)
      echo stopped
      ;;
    start)
      if [ -f config/spring.rb ]; then
        spring rake -T &> /dev/null
        sprint status
      else
        zeus start
      fi
      ;;
    *)
      exec "$@"
      ;;
  esac
fi
